<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="参考链接 # Go 程序员面试笔试宝典 语法特性 类型定义 12type f int &#x2F;&#x2F;定义了新类型，底层类型是int %T 是 ftype g &#x3D; int &#x2F;&#x2F;没有定义新类型，g只是int的别名 %T 仍是 int 标准库 context  context 用来解决 goroutine 之间退出通知、元数据传递的功能  创建 1234567891011121314151617&#x2F;&#x2F; 接口 DDE">
<meta property="og:type" content="article">
<meta property="og:title" content="Golang">
<meta property="og:url" content="http://localhost:4000/2024/01/26/read/golang/index.html">
<meta property="og:site_name" content="Jonas">
<meta property="og:description" content="参考链接 # Go 程序员面试笔试宝典 语法特性 类型定义 12type f int &#x2F;&#x2F;定义了新类型，底层类型是int %T 是 ftype g &#x3D; int &#x2F;&#x2F;没有定义新类型，g只是int的别名 %T 仍是 int 标准库 context  context 用来解决 goroutine 之间退出通知、元数据传递的功能  创建 1234567891011121314151617&#x2F;&#x2F; 接口 DDE">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.postimg.cc/sx31YFrn/Pasted-image-20240130142217.png">
<meta property="og:image" content="https://i.postimg.cc/XNgrVvft/Pasted-image-20240130201836.png">
<meta property="og:image" content="https://i.postimg.cc/gj4j4McG/Pasted-image-20240130202050.png">
<meta property="og:image" content="https://i.postimg.cc/K8Cz93b3/Pasted-image-20240126100429.png">
<meta property="og:image" content="https://i.postimg.cc/G2w4p8Sn/Pasted-image-20240129162057.png">
<meta property="og:image" content="https://i.postimg.cc/d12LZszk/Pasted-image-20240126184347.png">
<meta property="article:published_time" content="2024-01-26T01:58:04.552Z">
<meta property="article:modified_time" content="2024-04-10T01:35:31.055Z">
<meta property="article:author" content="jonas">
<meta property="article:tag" content="八股">
<meta property="article:tag" content="Golang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.postimg.cc/sx31YFrn/Pasted-image-20240130142217.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Golang</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 7.1.1"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search">Search</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/jonasrepo.github.io">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/02/04/read/%E7%BD%91%E7%BB%9C/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2024/01/24/read/linux%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://localhost:4000/2024/01/26/read/golang/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://localhost:4000/2024/01/26/read/golang/&text=Golang"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://localhost:4000/2024/01/26/read/golang/&title=Golang"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://localhost:4000/2024/01/26/read/golang/&is_video=false&description=Golang"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Golang&body=Check out this article: http://localhost:4000/2024/01/26/read/golang/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://localhost:4000/2024/01/26/read/golang/&title=Golang"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://localhost:4000/2024/01/26/read/golang/&title=Golang"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://localhost:4000/2024/01/26/read/golang/&title=Golang"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://localhost:4000/2024/01/26/read/golang/&title=Golang"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://localhost:4000/2024/01/26/read/golang/&name=Golang&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://localhost:4000/2024/01/26/read/golang/&t=Golang"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">参考链接</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">语法特性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="toc-number">2.1.</span> <span class="toc-text">类型定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E5%BA%93"><span class="toc-number">2.2.</span> <span class="toc-text">标准库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#context"><span class="toc-number">2.2.1.</span> <span class="toc-text">context</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">创建</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#reflect"><span class="toc-number">2.2.2.</span> <span class="toc-text">reflect</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">基本函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#unsafe"><span class="toc-number">2.2.3.</span> <span class="toc-text">unsafe</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">垃圾回收</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0"><span class="toc-number">3.1.</span> <span class="toc-text">三色标记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E6%94%B6%E8%BF%87%E7%A8%8B"><span class="toc-number">3.2.</span> <span class="toc-text">回收过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%B1%8F%E9%9A%9C"><span class="toc-number">3.3.</span> <span class="toc-text">写屏障</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#slice"><span class="toc-number">4.1.</span> <span class="toc-text">slice</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9%E7%AD%96%E7%95%A5"><span class="toc-number">4.1.1.</span> <span class="toc-text">扩容策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8"><span class="toc-number">4.2.</span> <span class="toc-text">哈希表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E5%93%88%E5%B8%8C%E8%A1%A8"><span class="toc-number">4.2.1.</span> <span class="toc-text">如何设计一个哈希表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%B3%E6%98%8E%E6%96%B9%E5%BC%8F"><span class="toc-number">4.2.2.</span> <span class="toc-text">申明方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#key%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.2.3.</span> <span class="toc-text">key类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.2.4.</span> <span class="toc-text">底层实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9"><span class="toc-number">4.2.5.</span> <span class="toc-text">扩容</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6"><span class="toc-number">4.2.5.1.</span> <span class="toc-text">条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E7%A8%8B"><span class="toc-number">4.2.5.2.</span> <span class="toc-text">过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.</span> <span class="toc-text">接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#channel"><span class="toc-number">4.4.</span> <span class="toc-text">channel</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">4.4.1.</span> <span class="toc-text">数据结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B"><span class="toc-number">4.4.2.</span> <span class="toc-text">发送数据流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8E%A5%E6%94%B6%E6%B5%81%E7%A8%8B"><span class="toc-number">4.4.3.</span> <span class="toc-text">数据接收流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9Cchannel%E6%83%85%E5%86%B5"><span class="toc-number">4.4.4.</span> <span class="toc-text">操作channel情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#channel%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2"><span class="toc-number">4.4.5.</span> <span class="toc-text">channel内存泄露</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">Goroutine调度器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1"><span class="toc-number">5.1.</span> <span class="toc-text">任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GPM%E8%B0%83%E5%BA%A6%E5%99%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.2.</span> <span class="toc-text">GPM调度器模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GPM"><span class="toc-number">5.2.1.</span> <span class="toc-text">GPM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%9F%E5%88%97"><span class="toc-number">5.2.2.</span> <span class="toc-text">队列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#work-stealing"><span class="toc-number">5.2.3.</span> <span class="toc-text">work stealing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hand-off"><span class="toc-number">5.2.4.</span> <span class="toc-text">hand off</span></a></li></ol></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Golang
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">jonas</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-01-26T01:58:04.552Z" class="dt-published" itemprop="datePublished">2024-01-26</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Golang/" rel="tag">Golang</a>, <a class="p-category" href="/tags/%E5%85%AB%E8%82%A1/" rel="tag">八股</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1>参考链接</h1>
<p><a target="_blank" rel="noopener" href="https://golang.design/go-questions/"># Go 程序员面试笔试宝典</a></p>
<h1>语法特性</h1>
<h2 id="类型定义">类型定义</h2>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> f <span class="type">int</span> <span class="comment">//定义了新类型，底层类型是int %T 是 f</span></span><br><span class="line"><span class="keyword">type</span> g = <span class="type">int</span> <span class="comment">//没有定义新类型，g只是int的别名 %T 仍是 int</span></span><br></pre></td></tr></table></figure>
<h2 id="标准库">标准库</h2>
<h3 id="context">context</h3>
<blockquote>
<p>context 用来解决 goroutine 之间<code>退出通知</code>、<code>元数据传递</code>的功能</p>
</blockquote>
<h4 id="创建">创建</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口 DDEV</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">interface</span> &#123;</span><br><span class="line">	Deadline() (deadline time.Time, ok <span class="type">bool</span>)</span><br><span class="line">	Done() &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">	Err() <span class="type">error</span></span><br><span class="line">	Value(key any) any</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//构造方式</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Background</span><span class="params">()</span></span> Context</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Todo</span><span class="params">()</span></span> Context</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithCancel</span><span class="params">(parent Context)</span></span> (ctx Context, cancel CancelFunc)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithDeadline</span><span class="params">(parent Context, deadline time.Time)</span></span> (Context, CancelFunc)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithTimeout</span><span class="params">(parent Context, timeout time.Duration)</span></span> (Context, CancelFunc)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithValue</span><span class="params">(parent Context, key, val <span class="keyword">interface</span>&#123;&#125;)</span></span> Context</span><br><span class="line"></span><br><span class="line">c := context.Background()<span class="comment">//空context</span></span><br></pre></td></tr></table></figure>
<p><img src="https://i.postimg.cc/sx31YFrn/Pasted-image-20240130142217.png" alt><br>
ValueContext value的寻找路径<br>
它会顺着链路一直往上找，比较当前节点的 key 是否是要找的 key，如果是，则直接返回 value。否则，一直顺着 context 往前，最终找到根节点（一般是 emptyCtx），直接返回一个 nil。所以用 Value 方法的时候要判断结果是否为 nil。<br>
因为查找方向是往上走的，所以，父节点没法获取子节点存储的值，子节点却可以获取父节点的值。</p>
<h3 id="reflect">reflect</h3>
<blockquote>
<p>Go 语言提供了一种机制在运行时更新变量和检查它们的值、调用它们的方法，但是在编译时并不知道这些变量的具体类型，这称为反射机制</p>
</blockquote>
<h4 id="基本函数">基本函数</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TypeOf</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> Type </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ValueOf</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> Value</span><br></pre></td></tr></table></figure>
<p><code>reflect.Type</code> 主要提供关于类型相关的信息，所以它和 <code>_type</code> 关联比较紧密<br>
<code>reflect.Value</code> 则结合 <code>_type</code> 和 <code>data</code> 两者，因此程序员可以获取甚至改变类型的值<br>
<img src="https://i.postimg.cc/XNgrVvft/Pasted-image-20240130201836.png" alt></p>
<h3 id="unsafe">unsafe</h3>
<blockquote>
<p>将任意的指针类型转成unsafe.Pointer ，所指向的数据不能被垃圾回收，不能进行指针运算<br>
uintptr 所指向的数据可以被垃圾回收，可以进行指针预算。</p>
</blockquote>
<ol>
<li>任何类型的指针和 unsafe.Pointer 可以相互转换。</li>
<li>uintptr 类型和 unsafe.Pointer 可以相互转换。<br>
<img src="https://i.postimg.cc/gj4j4McG/Pasted-image-20240130202050.png" alt></li>
</ol>
<h1>垃圾回收</h1>
<h2 id="三色标记">三色标记</h2>
<ul>
<li>白色对象（可能死亡）：未被回收器访问到的对象。在回收开始阶段，所有对象均为白色，当回收结束后，白色对象均不可达。</li>
<li>灰色对象（波面）：已被回收器访问到的对象，但回收器需要对其中的一个或多个指针进行扫描，因为他们可能还指向白色对象。</li>
<li>黑色对象（确定存活）：已被回收器访问到的对象，其中所有字段都已被扫描，黑色对象中任何一个指针都不可能直接指向白色对象。</li>
</ul>
<h2 id="回收过程">回收过程</h2>
<p>Go语言的垃圾回收（GC）过程是相对现代和高效的，设计上致力于减少应用程序的暂停时间。Go的垃圾回收器是一个并发的、三色标记清除（mark-sweep）垃圾回收器。下面是垃圾回收过程的大致步骤：</p>
<ol>
<li><strong>STW（Stop-The-World）开始阶段</strong>：
<ul>
<li>垃圾回收过程开始时，首先会有一个非常短暂的STW暂停，以便垃圾回收器可以执行一些初始化工作，这包括停止所有的Goroutine，确保它们都处于一个已知的、一致的状态。</li>
</ul>
</li>
<li><strong>标记（Mark）阶段</strong>：
<ul>
<li>垃圾回收器首先会标记所有根对象。根对象通常包括全局变量和当前执行堆栈中的变量。</li>
<li>然后，垃圾回收器并发运行，遍历所有的根对象，标记所有从这些根能够达到的对象，根对象会被标记成灰色。这个过程使用的是三色标记法，通过灰色对象不断地发现新的白色对象，并将它们标记为灰色，最终变成黑色。</li>
<li>在标记阶段，写屏障（write barrier）确保任何写操作都会被正确处理，以维持垃圾回收的数据一致性。</li>
</ul>
</li>
<li><strong>STW结束阶段</strong>：
<ul>
<li>一旦标记阶段完成，将会有另一个非常短暂的STW暂停。在这个阶段，写屏障会被禁用，并且垃圾回收器会完成最后的标记工作。</li>
</ul>
</li>
<li><strong>清除（Sweep）阶段</strong>：
<ul>
<li>清除阶段通常是并发进行的，不需要停止程序的执行。在这个阶段，垃圾回收器遍历堆内存，释放那些在标记阶段最终仍然标记为白色的对象所占用的内存。</li>
</ul>
</li>
<li><strong>内存整理</strong>：
<ul>
<li>Go的垃圾回收器不是一个压缩型的回收器，所以它不会移动对象来消除碎片。然而，Go使用了大小分级的空闲列表来减少内存碎片的影响。</li>
</ul>
</li>
<li><strong>结束</strong>：
<ul>
<li>垃圾回收循环结束，应用程序继续其正常执行，直到下一个GC周期启动</li>
</ul>
</li>
</ol>
<h2 id="写屏障">写屏障</h2>
<p>在标记阶段，为了避免停止整个程序（Stop-The-World, STW），Go的垃圾回收器会并发运行，与程序的其他部分一起执行。在这个并发执行期间，程序的执行线程可能会修改堆上的对象，这就可能导致一些问题，例如：</p>
<ul>
<li>程序可能会将一个黑色对象的引用赋值给一个白色对象，但是如果这个白色对象后来没有被扫描到，它就会在清扫（Sweep）阶段被错误地回收，这就破坏了垃圾回收器的正确性。<br>
为了解决这个问题，Go引入了写屏障。写屏障是一个在内存写操作期间自动执行的检查，它确保在垃圾回收期间的内存写操作不会破坏垃圾回收器的不变性。具体来说，当程序试图写入一个指针（例如，将一个对象的引用赋值给另一个对象的字段时），写屏障会介入并执行以下操作：</li>
<li>如果写操作是把一个黑色对象的引用赋给一个白色对象，写屏障会将那个白色对象标记为灰色（或直接标记为黑色，取决于具体的实现）。这样，即使是在并发标记阶段，新的引用关系也会被正确处理，从而保证了垃圾回收的正确性。<br>
写屏障的存在保证了即使在并发标记阶段，程序的正常运行也不会影响垃圾回收器的标记过程，使得并发垃圾回收成为可能，同时减少了程序的暂停时间。写屏障是实现高效垃圾回收机制的关键技术之一。在Go的实现中，写屏障通常只在垃圾回收的标记阶段启用，以减少其对程序性能的影响。</li>
</ul>
<h1>数据结构</h1>
<h2 id="slice">slice</h2>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// runtime/slice.go</span></span><br><span class="line"><span class="keyword">type</span> slice <span class="keyword">struct</span> &#123;</span><br><span class="line">	array unsafe.Pointer <span class="comment">// 元素指针</span></span><br><span class="line">	<span class="built_in">len</span>   <span class="type">int</span> <span class="comment">// 长度 </span></span><br><span class="line">	<span class="built_in">cap</span>   <span class="type">int</span> <span class="comment">// 容量</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="扩容策略">扩容策略</h3>
<ol>
<li>version &lt;1.18: 当原 slice 容量小于 <code>1024</code> 的时候，新 slice 容量变成原来的 <code>2</code> 倍；原 slice 容量超过 <code>1024</code>，新 slice 容量变成原来的<code>1.25</code>倍</li>
<li>version &gt;= 1.18:当原slice容量(oldcap)小于256的时候，新slice(newcap)容量为原来的2倍；原slice容量超过256，新slice容量$newcap = oldcap+(oldcap+3*256)/4$<br>
在扩容后会有一个内存对齐的操作，所以扩容后的大小会大于等于上面计算出来的</li>
</ol>
<h2 id="哈希表">哈希表</h2>
<h3 id="如何设计一个哈希表">如何设计一个哈希表</h3>
<ol>
<li>好的hash函数：结果均匀分布</li>
<li>解决哈希冲突：开放地址法，链表法</li>
<li>缩扩容</li>
</ol>
<h3 id="申明方式">申明方式</h3>
<h3 id="key类型">key类型</h3>
<blockquote>
<p>必须支持 != 和 == 比较，也就是 slice，func，map类型不支持</p>
</blockquote>
<h3 id="底层实现">底层实现</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> hmap <span class="keyword">struct</span> &#123;</span><br><span class="line">	count     <span class="type">int</span> <span class="comment">//表示当前哈希表中的元素数量</span></span><br><span class="line">	flags     <span class="type">uint8</span> <span class="comment">// iterator、oldlterator、hashWriting和 sameSizeGrow</span></span><br><span class="line">	B         <span class="type">uint8</span><span class="comment">//当前哈希表持有的buckets 数量, 2^B个桶</span></span><br><span class="line">	noverflow <span class="type">uint16</span> <span class="comment">//overflow bucket的大约数量</span></span><br><span class="line">	hash0     <span class="type">uint32</span> <span class="comment">//哈希的种子</span></span><br><span class="line"></span><br><span class="line">	buckets    unsafe.Pointer <span class="comment">//指向的是bmap[],每个bmap存储8个键值对</span></span><br><span class="line">	oldbuckets unsafe.Pointer  <span class="comment">//在扩容时用于保存之前buckets`的字段</span></span><br><span class="line">	nevacuate  <span class="type">uintptr</span> <span class="comment">//在map扩容阶段充当扩容进度计数器，所有下标号小于nevacuate的bucket都已经完成了</span></span><br><span class="line"></span><br><span class="line">	extra *mapextra</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> mapextra <span class="keyword">struct</span> &#123;</span><br><span class="line">	overflow    *[]*bmap<span class="comment">//指向overflow bucket的指针</span></span><br><span class="line">	oldoverflow *[]*bmap</span><br><span class="line">	nextOverflow *bmap</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> bmap <span class="keyword">struct</span> &#123;</span><br><span class="line">    topbits  [<span class="number">8</span>]<span class="type">uint8</span> <span class="comment">//存储哈希建的高8位</span></span><br><span class="line">    keys     [<span class="number">8</span>]keytype <span class="comment">//key， value分存储，减少了因内存对齐带来的内存浪费</span></span><br><span class="line">    values   [<span class="number">8</span>]valuetype</span><br><span class="line">    pad      <span class="type">uintptr</span></span><br><span class="line">    overflow <span class="type">uintptr</span> <span class="comment">//溢出后的指针</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://i.postimg.cc/K8Cz93b3/Pasted-image-20240126100429.png" alt></p>
<h3 id="扩容">扩容</h3>
<h4 id="条件">条件</h4>
<ol>
<li>装载因子已经超过 6.5；$\frac{count}{2^{B}}&gt;LoadFactor$</li>
<li>哈希使用了太多溢出桶；</li>
</ol>
<h4 id="过程">过程</h4>
<ol>
<li>如果是因为overflow bucket过多导致的“扩容”，实际上运行时会新建一个和现有规模<strong>一样</strong>的bucket数组–等量扩容 <code>sameSizeGrow</code>，然后在assign(插入)和delete(删除)时做排空和迁移</li>
<li>如果是因为当前数据数量超出LoadFactor指定水位而进行的扩容，那么运行时会建立一个<strong>两倍</strong>于现有规模的bucket数组–翻倍扩容，但真正的排空和迁移工作也是在assign和delete时逐步进行的。原bucket数组会挂在hmap的oldbuckets指针下面，直到原buckets数组中所有数据都迁移到新数组后，原buckets数组才会被释放</li>
</ol>
<h2 id="接口">接口</h2>
<blockquote>
<p>iface代表的是有方法的接口，eface代表的是无方法的接口，当时都包含data和_type的数据</p>
</blockquote>
<p>iface</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> iface <span class="keyword">struct</span> &#123;</span><br><span class="line">	tab  *itab</span><br><span class="line">	data unsafe.Pointer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> itab <span class="keyword">struct</span> &#123;</span><br><span class="line">	inter  *interfacetype</span><br><span class="line">	_type  *_type</span><br><span class="line">	link   *itab</span><br><span class="line">	hash   <span class="type">uint32</span> <span class="comment">// copy of _type.hash. Used for type switches.</span></span><br><span class="line">	bad    <span class="type">bool</span>   <span class="comment">// type does not implement interface</span></span><br><span class="line">	inhash <span class="type">bool</span>   <span class="comment">// has this itab been added to hash?</span></span><br><span class="line">	unused [<span class="number">2</span>]<span class="type">byte</span></span><br><span class="line">	fun    [<span class="number">1</span>]<span class="type">uintptr</span> <span class="comment">// variable sized</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>eface</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> eface <span class="keyword">struct</span> &#123;</span><br><span class="line">    _type *_type</span><br><span class="line">    data  unsafe.Pointer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接口实现</p>
<blockquote>
<p>接收者是值类型的方法，相当于自动实现了接收者是指针类型的方法  值类型== 值类型 + 指针类型的实现<br>
接收者是指针类型的方法，不会自动生成对应接收者是值类型的方法  指针类型== 指针类型</p>
</blockquote>
<p>是否实现接口检测</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _ io.Writer = (*myWriter)(<span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">var</span> _ io.Writer = myWriter&#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="channel">channel</h2>
<h3 id="数据结构">数据结构</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> hchan <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// chan 里元素数量</span></span><br><span class="line">	qcount   <span class="type">uint</span></span><br><span class="line">	<span class="comment">// chan 底层循环数组的长度</span></span><br><span class="line">	dataqsiz <span class="type">uint</span></span><br><span class="line">	<span class="comment">// 指向底层循环数组的指针</span></span><br><span class="line">	<span class="comment">// 只针对有缓冲的 channel</span></span><br><span class="line">	buf unsafe.Pointer</span><br><span class="line">	<span class="comment">// chan 中元素大小</span></span><br><span class="line">	elemsize <span class="type">uint16</span></span><br><span class="line">	<span class="comment">// chan 是否被关闭的标志</span></span><br><span class="line">	closed   <span class="type">uint32</span></span><br><span class="line">	<span class="comment">// chan 中元素类型</span></span><br><span class="line">	elemtype *_type <span class="comment">// element type</span></span><br><span class="line">	<span class="comment">// 已发送元素在循环数组中的索引</span></span><br><span class="line">	sendx    <span class="type">uint</span>   <span class="comment">// send index</span></span><br><span class="line">	<span class="comment">// 已接收元素在循环数组中的索引</span></span><br><span class="line">	recvx    <span class="type">uint</span>   <span class="comment">// receive index</span></span><br><span class="line">	<span class="comment">// 等待接收的 goroutine 队列</span></span><br><span class="line">	recvq    waitq  <span class="comment">// list of recv waiters</span></span><br><span class="line">	<span class="comment">// 等待发送的 goroutine 队列</span></span><br><span class="line">	sendq    waitq  <span class="comment">// list of send waiters</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 保护 hchan 中所有字段</span></span><br><span class="line">	lock mutex</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.postimg.cc/G2w4p8Sn/Pasted-image-20240129162057.png" alt></p>
<h3 id="发送数据流程">发送数据流程</h3>
<ol>
<li>首先，Go语言会检查channel是否已经关闭。如果channel已关闭，那么发送数据会直接触发panic。</li>
<li>判断channel是否为nil，如果是这挂起当前goroutine</li>
<li>然后，Go语言会检查是否有goroutine正在等待接收数据。如果有，那么发送数据会直接将数据发送给等待的goroutine，然后唤醒这个goroutine。</li>
<li>如果没有等待的goroutine，Go语言会尝试将数据存储到channel的缓冲区。如果缓冲区已满，那么发送数据的goroutine会被挂起，直到有空间将数据存储到缓冲区。</li>
<li>如果channel没有缓冲区（也就是非缓冲channel），那么发送数据的goroutine会被挂起，直到有goroutine来接收数据。</li>
<li>在数据被成功发送后，Go语言会唤醒所有等待在该channel上的goroutine，让它们有机会接收新的数据。</li>
</ol>
<h3 id="数据接收流程">数据接收流程</h3>
<ol>
<li>首先，Go语言会检查channel是否有等待发送的数据。如果有，那么接收数据会直接从channel的发送队列中取出数据。</li>
<li>如果channel没有等待发送的数据，但是channel有缓冲区并且缓冲区中有数据，那么接收数据会从缓冲区中取出数据。</li>
<li>如果channel没有等待发送的数据，且channel的缓冲区为空或者没有缓冲区（也就是非缓冲channel），那么接收数据的goroutine会被挂起，直到有数据被发送到channel。</li>
<li>在数据被成功接收后，Go语言会唤醒所有等待在该channel上的goroutine，让它们有机会发送新的数据。</li>
<li>如果channel已经被关闭，并且channel中没有等待被接收的数据，那么接收操作会立即返回一个零值和一个可选的布尔值（如果使用了两值接收形式）。这个布尔值表示是否成功接收到数据，如果channel已经关闭，那么这个值将为false。</li>
</ol>
<h3 id="操作channel情况">操作channel情况</h3>
<table>
<thead>
<tr>
<th>操作</th>
<th>nil channel</th>
<th>closed channel</th>
<th>not nil, not closed channel</th>
</tr>
</thead>
<tbody>
<tr>
<td>close</td>
<td>panic</td>
<td>panic</td>
<td>正常关闭</td>
</tr>
<tr>
<td>读 &lt;- ch</td>
<td>阻塞</td>
<td>读到对应类型的零值</td>
<td>阻塞或正常读取数据。缓冲型 channel 为空或非缓冲型 channel 没有等待发送者时会阻塞</td>
</tr>
<tr>
<td>写 ch &lt;-</td>
<td>阻塞</td>
<td>panic</td>
<td>阻塞或正常写入数据。非缓冲型 channel 没有等待接收者或缓冲型 channel buf 满时会被阻塞</td>
</tr>
</tbody>
</table>
<h3 id="channel内存泄露">channel内存泄露</h3>
<p>goroutine 操作 channel 后，处于发送或接收阻塞状态，而 channel 处于满或空的状态，一直得不到改变。同时，垃圾回收器也不会回收此类资源，进而导致 gouroutine 会一直处于等待队列中，不能被回收。</p>
<h1>Goroutine调度器</h1>
<h2 id="任务">任务</h2>
<p>将Goroutine按照一定算法放到不同的操作系统线程中去执行</p>
<h2 id="GPM调度器模型">GPM调度器模型</h2>
<h3 id="GPM">GPM</h3>
<ul>
<li>G: 代表Goroutine，存储了Goroutine的执行栈信息、Goroutine状态以及Goroutine的任务函数等，而且G对象是可以重用的；</li>
<li>P: 代表逻辑processor，为 M 的执行提供“上下文”，P的数量决定了系统内最大可并行的G的数量，P的最大作用还是其拥有的各种G对象队列、链表、一些缓存和状态；一个 M 只有绑定 P 才能执行 goroutine，当 M 被阻塞时，整个 P 会被传递给其他 M</li>
<li>M: M代表着真正的执行计算资源。在绑定有效的P后，进入一个调度循环，而调度循环的机制大致是<strong>从P的本地运行队列以及全局队列中获取G，切换到G的执行栈上并执行G的函数，调用goexit做清理工作并回到M，如此反复</strong>。M并不保留G状态，这是G可以跨M调度的基础。</li>
</ul>
<h3 id="队列">队列</h3>
<p>队列分为全局队列和P的本地队列<br>
新创建的goroutine优先放在本地队列，如果本地队列满了，就拿本地队列的一半放倒全局队列</p>
<h3 id="work-stealing">work stealing</h3>
<p>当一个 P 发现自己的 LRQ 已经没有 G 时，并且这时 GRQ 也没有 G 了。这时，P2 会随机选择一个 P（称为 P1），P2 会从 P1 的 LRQ “偷”过来一半的 G</p>
<h3 id="hand-off">hand off</h3>
<p>当 M 执行的 G 发生阻塞操作或者发生了系统调用，M 就会阻塞，如果当前绑定的P还有要执行的 G,  Go runtime 会把这个 P 从 M 摘除，M 进入阻塞（对应下图中的M1），P 分离给其它空闲 M 调度（对应下图中的M2）<br>
当 M 系统调用（或阻塞）结束时，这个 G 会尝试获取一个空闲的 P 执行，并放入到这个 P 的本地队列，如果获取不到 P，那么这个 G 加入到全局 G 里，这个 M 会加入到空闲线程列表中，重新可以进入调度循环<br>
<img src="https://i.postimg.cc/d12LZszk/Pasted-image-20240126184347.png" alt></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/search">Search</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/jonasrepo.github.io">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">参考链接</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">语法特性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="toc-number">2.1.</span> <span class="toc-text">类型定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E5%BA%93"><span class="toc-number">2.2.</span> <span class="toc-text">标准库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#context"><span class="toc-number">2.2.1.</span> <span class="toc-text">context</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">创建</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#reflect"><span class="toc-number">2.2.2.</span> <span class="toc-text">reflect</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">基本函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#unsafe"><span class="toc-number">2.2.3.</span> <span class="toc-text">unsafe</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">垃圾回收</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0"><span class="toc-number">3.1.</span> <span class="toc-text">三色标记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E6%94%B6%E8%BF%87%E7%A8%8B"><span class="toc-number">3.2.</span> <span class="toc-text">回收过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%B1%8F%E9%9A%9C"><span class="toc-number">3.3.</span> <span class="toc-text">写屏障</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#slice"><span class="toc-number">4.1.</span> <span class="toc-text">slice</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9%E7%AD%96%E7%95%A5"><span class="toc-number">4.1.1.</span> <span class="toc-text">扩容策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8"><span class="toc-number">4.2.</span> <span class="toc-text">哈希表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E5%93%88%E5%B8%8C%E8%A1%A8"><span class="toc-number">4.2.1.</span> <span class="toc-text">如何设计一个哈希表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%B3%E6%98%8E%E6%96%B9%E5%BC%8F"><span class="toc-number">4.2.2.</span> <span class="toc-text">申明方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#key%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.2.3.</span> <span class="toc-text">key类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.2.4.</span> <span class="toc-text">底层实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9"><span class="toc-number">4.2.5.</span> <span class="toc-text">扩容</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6"><span class="toc-number">4.2.5.1.</span> <span class="toc-text">条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E7%A8%8B"><span class="toc-number">4.2.5.2.</span> <span class="toc-text">过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.</span> <span class="toc-text">接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#channel"><span class="toc-number">4.4.</span> <span class="toc-text">channel</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">4.4.1.</span> <span class="toc-text">数据结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B"><span class="toc-number">4.4.2.</span> <span class="toc-text">发送数据流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8E%A5%E6%94%B6%E6%B5%81%E7%A8%8B"><span class="toc-number">4.4.3.</span> <span class="toc-text">数据接收流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9Cchannel%E6%83%85%E5%86%B5"><span class="toc-number">4.4.4.</span> <span class="toc-text">操作channel情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#channel%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2"><span class="toc-number">4.4.5.</span> <span class="toc-text">channel内存泄露</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">Goroutine调度器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1"><span class="toc-number">5.1.</span> <span class="toc-text">任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GPM%E8%B0%83%E5%BA%A6%E5%99%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.2.</span> <span class="toc-text">GPM调度器模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GPM"><span class="toc-number">5.2.1.</span> <span class="toc-text">GPM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%9F%E5%88%97"><span class="toc-number">5.2.2.</span> <span class="toc-text">队列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#work-stealing"><span class="toc-number">5.2.3.</span> <span class="toc-text">work stealing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hand-off"><span class="toc-number">5.2.4.</span> <span class="toc-text">hand off</span></a></li></ol></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://localhost:4000/2024/01/26/read/golang/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://localhost:4000/2024/01/26/read/golang/&text=Golang"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://localhost:4000/2024/01/26/read/golang/&title=Golang"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://localhost:4000/2024/01/26/read/golang/&is_video=false&description=Golang"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Golang&body=Check out this article: http://localhost:4000/2024/01/26/read/golang/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://localhost:4000/2024/01/26/read/golang/&title=Golang"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://localhost:4000/2024/01/26/read/golang/&title=Golang"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://localhost:4000/2024/01/26/read/golang/&title=Golang"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://localhost:4000/2024/01/26/read/golang/&title=Golang"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://localhost:4000/2024/01/26/read/golang/&name=Golang&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://localhost:4000/2024/01/26/read/golang/&t=Golang"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2024
    jonas
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search">Search</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/jonasrepo.github.io">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
